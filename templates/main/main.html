{% load static%}
<!doctype html>
<html lang="ko">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <!-- google icons-->
    <style>
      .box {
        width: 150px;
        height: 150px;
        border-radius: 70%;
        overflow: hidden;
      }

      .profile {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .feed_box {
        margin: 20px 0;
        border: solid 1px gray;
        background-color: white;
      }

      .modal_overlay {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(1.5px);
        -webkit-backdrop-filter: blur(1.5px);
      }

      .modal_window {
        background: white;
        backdrop-filter: blur(13.5px);
        -webkit-backdrop-filter: blur(13.5px);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        width: 800px;
        height: 600px;
        position: relative;
        padding: 10px;

      }
    </style>
  </head>

  <body>

    <nav class="navbar navbar-expand-lg bg-light" style="position:fixed; width:100%; ">
      <div class="container-fluid" style="justify-content: space-between; flex-wrap: nowrap; min-width:1000px">
        <a class="navbar-brand" href="#">
          <img src="{% static 'img/koinstar.jpeg'%}" / style="width:100px; height:30px">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" style="width:400px">
        <div>
          <span class="material-symbols-outlined">
            home
          </span>
          <span class="material-symbols-outlined">
            send
          </span>
          <span id="nav_add_box" class="material-symbols-outlined">
            add_box
          </span>
          <span class="material-symbols-outlined">
            explore
          </span>
          <span class="material-symbols-outlined">
            favorite
          </span>
        </div>

      </div>
    </nav>
    <!-- -->
    <div style="display:flex; flex-direction:row; text-align:center; padding-top:60px; justify-content:center; background-color:#FAFAFA;">

      <div style="width:500px; min-width:500px; height:1000px; margin-right:300px">
        <!-- feed box-->
        {% for feed in feeds %}
          <div class="feed_box">
            <div style="display:flex; flex-direction:row; align-items:center; padding:10px;">
              <div class="box" style="width:60px; height:60px; margin:0 10px;">
                <img class="profile" src="{{feed.profile_image}}">
              </div>
              <div style="">
                {{feed.user_id}}
              </div>
            </div>
            <div>
              <img style="width:100%; " src="{% get_media_prefix %}{{feed.image}}">
            </div>
            <div style="display:flex; margin: 0 20px; justify-content:space-between;  ">
              <div>
                <span class="material-symbols-outlined">
                  favorite
                </span>
                <span class="material-symbols-outlined">
                  mode_comment
                </span>
                <span class="material-symbols-outlined">
                  send
                </span>
              </div>
              <div>
                <span class="material-symbols-outlined">
                  bookmark
                </span>
              </div>
            </div>
            <div style="margin:20px; text-align:left; font-size:14px; ">
              김제운
              <b>{{feed.like_count}}명</b>
              이 좋아요중
            </div>

            <div style=" margin:20px; text-align:left; font-size:14px;">
              <b>{{feed.user_id}}</b>
              {{feed.content}}
            </div>
            <div style=" margin: 0 20px; text-align:left; font-size:12px;">
              <b>{{feed.user_id }}</b>
              {{feed.content}}
            </div>
            <div style=" margin: 0 20px; text-align:left; font-size:12px;">
              <b>이재명</b>
              댓글2번 째 테스트 댓글은 아직입니다.
            </div>
            <div style="">
              <input style="box-shadow:none; border:none; outline:none;" type="text" class="form-control" placeholder="댓글 달기">
            </div>
          </div>

        {% endfor %}

      </div>

      <!-- right-->
      <div style="width:400px; height:1000px; position:fixed; left:62%; ">
        <div style="display:flex; flex-direction:row; align-items:center; padding:10px 0px;">
          <div class="box" style="width:70px; height:70px; ">
            <img class="profile" src="https://i.pinimg.com/originals/2c/ee/e1/2ceee1b850118c6f9cd1eeba99f44463.gif">
          </div>
          <div style="text-align:left; margin-left:10px">
            <div>
              <b>김제운</b>
            </div>
            <div style="color:gray">Gwangmin Oh</div>
          </div>
        </div>
        <div style="display:flex; flex-direction:row; justify-content:space-between;">
          <div>
            <span style="font-weight:bold; color:gray;">회원님을위한 추천</span>
          </div>
          <div>
            <a href="#" style="text-decoration:none; color:black; font-weight:bold;">모두 보기</a>
          </div>
        </div>

        <div style="display:flex; flex-direction:row; justify-content:space-between; align-items:center; margin-top:10px">
          <div style="display:flex;  flex-direction:row; ">
            <div class="box" style="width:35px; height:35px;">
              <img class="profile" src="https://i.pinimg.com/originals/2c/ee/e1/2ceee1b850118c6f9cd1eeba99f44463.gif">
            </div>
            <div style="text-align:left; margin-left:10px">
              <div style="font-size:13px">
                <b>김제운</b>
              </div>
              <div style="color:gray">Gwangmin Oh</div>
            </div>
          </div>
          <div>
            <a href="#" style="text-decoration:none;  font-weight:bold; font-size:14px;">팔로우</a>
          </div>
        </div>
        <div style="display:flex; flex-direction:row; justify-content:space-between; align-items:center; ">
          <div style="display:flex;  flex-direction:row; ">
            <div class="box" style="width:35px; height:35px;">
              <img class="profile" src="https://i.pinimg.com/originals/2c/ee/e1/2ceee1b850118c6f9cd1eeba99f44463.gif">
            </div>
            <div style="text-align:left; margin-left:10px">
              <div style="font-size:13px">
                <b>김제운</b>
              </div>
              <div style="color:gray">Gwangmin Oh</div>
            </div>
          </div>
          <div>
            <a href="#" style="text-decoration:none;  font-weight:bold; font-size:14px;">팔로우</a>
          </div>
        </div>

        <div style="display:flex; flex-direction:row; justify-content:space-between; align-items:center;">
          <div style="display:flex;  flex-direction:row; ">
            <div class="box" style="width:35px; height:35px;">
              <img class="profile" src="https://i.pinimg.com/originals/2c/ee/e1/2ceee1b850118c6f9cd1eeba99f44463.gif">
            </div>
            <div style="text-align:left; margin-left:10px">
              <div style="font-size:13px">
                <b>김제운</b>
              </div>
              <div style="color:gray">Gwangmin Oh</div>
            </div>
          </div>
          <div>
            <a href="#" style="text-decoration:none;  font-weight:bold; font-size:14px;">팔로우</a>
          </div>
        </div>
        <div style="text-align:left; color:gray; font-size:14px; margin:20px 0px;">
          <div style="margin:20px 0px;">소개도움말홍보 센터API채용 정보개인정보처리방침<br>약관위치언어
          </div>
          <div>© 2023 INSTAGRAM FROM META</div>
        </div>
      </div>
    </div>

    <!-- 첫번째 모달 -->
    <div id="first_modal" class="modal_overlay">
      <div class="modal_window">
        <div style="display:flex; flex-direction:row; justify-content:space-between;">
          <div style="width:40px; background:gray;"></div>
          <div>새 이미지 업로드</div>
          <div style="width:40px; background:gray;">
            <span class="material-symbols-outlined">
              close
            </span>
          </div>
        </div>
        <div class="img_drop" style="border-top: solid 1px gray; width:778px; height:540px; margin-top:10px;"></div>
      </div>
    </div>
    <!-- 두번째 모달 -->
    <div id="second_modal" class="modal_overlay">
      <div class="modal_window">
        <div style="display:flex; flex-direction:row; justify-content:space-between;">
          <div style="width:40px; background:gray;"></div>
          <div>새 이미지 업로드</div>
          <div style="width:40px; background:gray;">
            <span class="material-symbols-outlined">
              close
            </span>
          </div>
        </div>
        <div style="display:flex; flex-direction:row; border-top: solid 1px gray;">
          <div class="img_drop" style="  width:550px; height:540px; margin-top:10px;"></div>

          <div style="border-left:solid 1px gray;">
            <div>
              <textarea id="feed_content" style="width:276px; height:400px;" class="form-control" rows="5"></textarea>
            </div>
            <button id="feed_create_button" type="button" class="btn btn-primary" style="width:100%;">
              공유하기
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- jquery-->
    <script src="{% static 'jquery.min.js' %}"></script>
    <!-- bootstrap-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  </body>

</html>
<script>
  let files;

  $('#feed_create_button').click(function () {

    alert('공유하기' + $('#feed_content').val());

    //맨첫번째 파일만 넣어줌
    let file = files[0];
    let image = files[0].name;
    // 내가 쓴값
    let content = $('#feed_content').val();
    let user_id = "chlwpdns";
    let profile_image = "https://i.pinimg.com/originals/2c/ee/e1/2ceee1b850118c6f9cd1eeba99f44463.gif"

    //파일업로드는 formdata를 업로드를 해야한다.
    let fd = new FormData();
    fd.append('file', file);
    fd.append('image', image);
    fd.append('content', content);
    fd.append('user_id', user_id);
    fd.append('profile_image', profile_image);

    $.ajax({
      url: '/main/upload',
      data: fd,
      method: "POST",
      processData: false,
      contentType: false,
      success: function (data) {
        console.log('성공');
      },
      error: function (request, status, error) {
        console.log('에러');
      },
      complete: function () {
        console.log('완료')
        //모달 닫아주기 or 메인으로 다시가는거(페이지 새로고침)
        location.replace("/")
      }
    })
  });

  $('#nav_add_box').click(function () {
    $('#first_modal').css({display: 'flex'})

    $(document.body).css({overflow: 'hidden'});
  });

  // dragover

  $('.img_drop')
    .on("dragover", dragOver)
    .on("dragleave", dragOver)
    .on("drop", uploadFiles);

  function dragOver(e) {
    e.stopPropagation();
    e.preventDefault();
    if (e.type == 'dragover') {
      $(e.target).css({"background-color": 'black', "outline-offset": "-20px"});
    } else {
      $(e.target).css({"outline-offset": "-10px"})
    }
  }

  function uploadFiles(e) {
    e.stopPropagation();
    e.preventDefault();

    e.dataTransfer = e.originalEvent.dataTransfer; //2
    files = e.target.files || e.dataTransfer.files;

    if (files.length > 1) {
      alert('하나만 올려라.');
      return;
    }
    // file_upload 이후
    if (files[0].type.match(/image.*/)) {

      $('#first_modal').css({display: 'none'})

      $('#second_modal').css({display: 'flex'})

      // 여기서 종요한것 ! e.target 이 있는데 target으로 하지말고 class 명으로해보기!
      $('.img_drop').css({
        "background-image": "url(" + window
          .URL
          .createObjectURL(files[0]) + ")",
        "outline": "none",
        "background-size": "100%",
        "background-repeat": "no-repeat",
        "background-position": "center"
      });
    } else {
      alert('이미지가 아닙니다.');
      return;
    }

  }
</script>
